# Dicion√°rio de Dados - Sistema de Delivery

## Informa√ß√µes Gerais
- **Sistema**: Better Food - Plataforma de Delivery
- **SGBD**: PostgreSQL com Supabase
- **Vers√£o**: 1.0
- **Data**: Dezembro 2024

---

## üìã √çNDICE DE TABELAS

1. [PROFILES](#profiles) - Perfis de Usu√°rio
2. [STORES](#stores) - Estabelecimentos
3. [STORE_CATEGORIES](#store_categories) - Categorias de Estabelecimentos
4. [PRODUCTS](#products) - Produtos/Card√°pio
5. [PRODUCT_CATEGORIES](#product_categories) - Categorias de Produtos
6. [PRODUCT_PRICE_HISTORY](#product_price_history) - Hist√≥rico de Pre√ßos
7. [ORDERS](#orders) - Pedidos
8. [ORDER_ITEMS](#order_items) - Itens do Pedido
9. [ORDER_RATINGS](#order_ratings) - Avalia√ß√µes de Pedidos
10. [PAYMENTS](#payments) - Pagamentos
11. [COUPONS](#coupons) - Cupons de Desconto
12. [CHATS](#chats) - Conversas por Pedido
13. [CHAT_MESSAGES](#chat_messages) - Mensagens do Chat
14. [CLIENT_CHAT_NOTIFICATIONS](#client_chat_notifications) - Notifica√ß√µes de Chat
15. [NOTIFICATIONS](#notifications) - Notifica√ß√µes do Sistema

---

## PROFILES
**Descri√ß√£o**: Armazena informa√ß√µes dos perfis de usu√°rios (clientes e administradores de loja)

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | - | PK | Identificador √∫nico do usu√°rio |
| email | text | Vari√°vel | SIM | - | - | Email do usu√°rio |
| role | enum (user_role) | Vari√°vel | SIM | 'customer' | - | Papel do usu√°rio (customer/admin) |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |
| total_orders | integer | 4 bytes | SIM | 0 | - | Total de pedidos realizados |
| total_spent | numeric | Vari√°vel | SIM | 0 | - | Valor total gasto pelo usu√°rio |
| last_order_at | timestamp with time zone | - | SIM | - | - | Data/hora do √∫ltimo pedido |
| average_order_value | numeric | Vari√°vel | SIM | 0 | - | Valor m√©dio dos pedidos |

**Chaves Estrangeiras:**
- id ‚Üí auth.users(id)

**√çndices:**
- PK: profiles_pkey (id)

---

## STORES
**Descri√ß√£o**: Armazena informa√ß√µes dos estabelecimentos/lojas

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico da loja |
| name | text | Vari√°vel | N√ÉO | - | - | Nome da loja |
| category_id | uuid | 36 | N√ÉO | - | FK | Categoria da loja |
| order_count | integer | 4 bytes | SIM | 0 | - | Contador de pedidos da loja |
| logo_url | text | Vari√°vel | SIM | - | - | URL do logo da loja |
| admin_id | uuid | 36 | N√ÉO | - | FK,UK | Administrador respons√°vel |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | SIM | now() | - | Data/hora da √∫ltima atualiza√ß√£o |
| is_visible | boolean | 1 byte | N√ÉO | true | - | Controla visibilidade da loja |

**Chaves Estrangeiras:**
- category_id ‚Üí store_categories(id)
- admin_id ‚Üí profiles(id)

**√çndices:**
- PK: stores_pkey (id)
- UK: admin_id (√∫nico)

---

## STORE_CATEGORIES
**Descri√ß√£o**: Categorias dos estabelecimentos (ex: Lanches, Pizza, Sushi)

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico da categoria |
| name | text | Vari√°vel | N√ÉO | - | UK | Nome da categoria |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | SIM | now() | - | Data/hora da √∫ltima atualiza√ß√£o |

**√çndices:**
- PK: store_categories_pkey (id)
- UK: name (√∫nico)

---

## PRODUCTS
**Descri√ß√£o**: Produtos/itens do card√°pio dos estabelecimentos

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do produto |
| name | text | Vari√°vel | N√ÉO | - | - | Nome do produto |
| price | numeric | Vari√°vel | N√ÉO | - | - | Pre√ßo do produto |
| category_id | uuid | 36 | N√ÉO | - | FK | Categoria do produto |
| is_available | boolean | 1 byte | SIM | true | - | Disponibilidade do produto |
| image_url | text | Vari√°vel | SIM | - | - | URL da imagem do produto |
| store_id | uuid | 36 | N√ÉO | - | FK | Loja propriet√°ria |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | SIM | now() | - | Data/hora da √∫ltima atualiza√ß√£o |
| description | text | Vari√°vel | SIM | - | - | Descri√ß√£o detalhada |
| total_sales | integer | 4 bytes | SIM | 0 | - | Total de vendas do produto |
| total_revenue | numeric | Vari√°vel | SIM | 0 | - | Receita total gerada |
| last_sale_at | timestamp with time zone | - | SIM | - | - | Data/hora da √∫ltima venda |

**Chaves Estrangeiras:**
- category_id ‚Üí product_categories(id)
- store_id ‚Üí stores(id)

**√çndices:**
- PK: products_pkey (id)

---

## PRODUCT_CATEGORIES
**Descri√ß√£o**: Categorias dos produtos (ex: Bebidas, Lanches, Sobremesas)

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico da categoria |
| name | text | Vari√°vel | N√ÉO | - | UK | Nome da categoria |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | SIM | now() | - | Data/hora da √∫ltima atualiza√ß√£o |

**√çndices:**
- PK: product_categories_pkey (id)
- UK: name (√∫nico)

---

## PRODUCT_PRICE_HISTORY
**Descri√ß√£o**: Hist√≥rico de altera√ß√µes de pre√ßos dos produtos

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do registro |
| product_id | uuid | 36 | SIM | - | FK | Produto alterado |
| old_price | numeric | Vari√°vel | SIM | - | - | Pre√ßo anterior |
| new_price | numeric | Vari√°vel | SIM | - | - | Novo pre√ßo |
| changed_at | timestamp with time zone | - | SIM | now() | - | Data/hora da altera√ß√£o |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o do registro |

**Chaves Estrangeiras:**
- product_id ‚Üí products(id)

**√çndices:**
- PK: product_price_history_pkey (id)

---

## ORDERS
**Descri√ß√£o**: Pedidos realizados pelos clientes

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do pedido |
| user_id | uuid | 36 | N√ÉO | - | FK | Cliente que fez o pedido |
| store_id | uuid | 36 | N√ÉO | - | FK | Loja do pedido |
| status | enum (order_status) | Vari√°vel | N√ÉO | 'pending' | - | Status do pedido |
| total_amount | numeric | Vari√°vel | N√ÉO | - | - | Valor total do pedido |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |
| admin_id | uuid | 36 | N√ÉO | - | FK | Admin respons√°vel pelo pedido |
| coupon_id | uuid | 36 | SIM | - | FK | Cupom aplicado (se houver) |
| discount_amount | numeric | Vari√°vel | SIM | 0 | - | Valor do desconto aplicado |
| is_counted | boolean | 1 byte | SIM | false | - | Se foi contabilizado nos relat√≥rios |
| observations | text | Vari√°vel | SIM | - | - | Observa√ß√µes do cliente |

**Chaves Estrangeiras:**
- user_id ‚Üí auth.users(id)
- store_id ‚Üí stores(id)
- admin_id ‚Üí profiles(id)
- coupon_id ‚Üí coupons(id)

**√çndices:**
- PK: orders_pkey (id)

---

## ORDER_ITEMS
**Descri√ß√£o**: Itens individuais que comp√µem cada pedido

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do item |
| order_id | uuid | 36 | N√ÉO | - | FK | Pedido ao qual pertence |
| product_id | uuid | 36 | N√ÉO | - | FK | Produto solicitado |
| quantity | integer | 4 bytes | N√ÉO | - | - | Quantidade do produto |
| unit_price | numeric | Vari√°vel | N√ÉO | - | - | Pre√ßo unit√°rio no momento |
| total_price | numeric | Vari√°vel | N√ÉO | - | - | Pre√ßo total do item |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |

**Chaves Estrangeiras:**
- order_id ‚Üí orders(id)
- product_id ‚Üí products(id)

**√çndices:**
- PK: order_items_pkey (id)

---

## ORDER_RATINGS
**Descri√ß√£o**: Avalia√ß√µes feitas pelos clientes ap√≥s a entrega

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico da avalia√ß√£o |
| user_id | uuid | 36 | N√ÉO | - | FK | Cliente que avaliou |
| order_id | uuid | 36 | N√ÉO | - | FK,UK | Pedido avaliado (√∫nico) |
| store_id | uuid | 36 | N√ÉO | - | FK | Loja avaliada |
| rating | integer | 4 bytes | N√ÉO | - | - | Nota geral (1-5) |
| comment | text | Vari√°vel | SIM | - | - | Coment√°rio da avalia√ß√£o |
| delivery_rating | integer | 4 bytes | SIM | - | - | Nota da entrega (1-5) |
| food_rating | integer | 4 bytes | SIM | - | - | Nota da comida (1-5) |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |

**Chaves Estrangeiras:**
- user_id ‚Üí auth.users(id)
- order_id ‚Üí orders(id)
- store_id ‚Üí stores(id)

**Restri√ß√µes:**
- rating: CHECK (rating >= 1 AND rating <= 5)
- delivery_rating: CHECK (delivery_rating >= 1 AND delivery_rating <= 5)
- food_rating: CHECK (food_rating >= 1 AND food_rating <= 5)

**√çndices:**
- PK: order_ratings_pkey (id)
- UK: order_id (√∫nico)

---

## PAYMENTS
**Descri√ß√£o**: Registros de pagamentos processados

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do pagamento |
| order_id | uuid | 36 | N√ÉO | - | FK | Pedido relacionado |
| pagbank_id | text | Vari√°vel | N√ÉO | - | - | ID da transa√ß√£o no PagBank |
| amount | numeric | Vari√°vel | N√ÉO | - | - | Valor do pagamento |
| response_data | jsonb | Vari√°vel | SIM | - | - | Dados de resposta da operadora |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |
| status | enum (payment_status) | Vari√°vel | N√ÉO | - | - | Status do pagamento |
| payment_method | enum (payment_method) | Vari√°vel | N√ÉO | - | - | M√©todo de pagamento usado |

**Chaves Estrangeiras:**
- order_id ‚Üí orders(id)

**√çndices:**
- PK: payments_pkey (id)

---

## COUPONS
**Descri√ß√£o**: Cupons de desconto dispon√≠veis no sistema

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico do cupom |
| name | text | Vari√°vel | N√ÉO | - | UK | Nome/c√≥digo do cupom |
| discount | integer | 4 bytes | N√ÉO | - | - | Percentual de desconto (1-100) |
| amount_used | integer | 4 bytes | SIM | 0 | - | Quantidade de vezes usado |
| is_active | boolean | 1 byte | SIM | true | - | Se o cupom est√° ativo |
| created_at | timestamp with time zone | - | SIM | now() | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | SIM | now() | - | Data/hora da √∫ltima atualiza√ß√£o |

**Restri√ß√µes:**
- discount: CHECK (discount > 0 AND discount <= 100)

**√çndices:**
- PK: coupons_pkey (id)
- UK: name (√∫nico)

---

## CHATS
**Descri√ß√£o**: Canais de comunica√ß√£o entre cliente e loja por pedido

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | gen_random_uuid() | PK | Identificador √∫nico do chat |
| store_id | uuid | 36 | N√ÉO | - | FK | Loja participante |
| user_id | uuid | 36 | N√ÉO | - | FK | Cliente participante |
| order_id | uuid | 36 | N√ÉO | - | FK | Pedido relacionado |
| status | enum (chat_status) | Vari√°vel | SIM | 'active' | - | Status do chat |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |
| last_viewed_at | timestamp with time zone | - | SIM | - | - | √öltima visualiza√ß√£o |
| has_new_messages | boolean | 1 byte | SIM | false | - | Indica mensagens n√£o lidas |
| last_read_at | timestamp with time zone | - | SIM | - | - | √öltima leitura |

**Chaves Estrangeiras:**
- store_id ‚Üí stores(id)
- user_id ‚Üí profiles(id)
- order_id ‚Üí orders(id)

**√çndices:**
- PK: chats_pkey (id)

---

## CHAT_MESSAGES
**Descri√ß√£o**: Mensagens individuais dos chats

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | gen_random_uuid() | PK | Identificador √∫nico da mensagem |
| chat_id | uuid | 36 | N√ÉO | - | FK | Chat ao qual pertence |
| sender_id | uuid | 36 | N√ÉO | - | FK | Remetente da mensagem |
| content | text | Vari√°vel | N√ÉO | - | - | Conte√∫do da mensagem |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de envio |
| read_at | timestamp with time zone | - | SIM | - | - | Data/hora de leitura |

**Chaves Estrangeiras:**
- chat_id ‚Üí chats(id)
- sender_id ‚Üí profiles(id)

**√çndices:**
- PK: chat_messages_pkey (id)

---

## CLIENT_CHAT_NOTIFICATIONS
**Descri√ß√£o**: Controle de notifica√ß√µes de chat por cliente

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | gen_random_uuid() | PK | Identificador √∫nico |
| chat_id | uuid | 36 | N√ÉO | - | FK | Chat relacionado |
| profile_id | uuid | 36 | N√ÉO | - | FK | Perfil do cliente |
| has_unread_messages | boolean | 1 byte | SIM | false | - | Mensagens n√£o lidas |
| last_read_at | timestamp with time zone | - | SIM | - | - | √öltima leitura |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |

**Chaves Estrangeiras:**
- chat_id ‚Üí chats(id)
- profile_id ‚Üí profiles(id)

**√çndices:**
- PK: client_chat_notifications_pkey (id)

---

## NOTIFICATIONS
**Descri√ß√£o**: Notifica√ß√µes gerais do sistema para usu√°rios

| Campo | Tipo | Tamanho | Nulo | Padr√£o | Chave | Descri√ß√£o |
|-------|------|---------|------|--------|-------|-----------|
| id | uuid | 36 | N√ÉO | uuid_generate_v4() | PK | Identificador √∫nico da notifica√ß√£o |
| user_id | uuid | 36 | N√ÉO | - | FK | Usu√°rio destinat√°rio |
| title | text | Vari√°vel | N√ÉO | - | - | T√≠tulo da notifica√ß√£o |
| description | text | Vari√°vel | N√ÉO | - | - | Descri√ß√£o detalhada |
| status | enum (notification_status) | Vari√°vel | N√ÉO | 'unread' | - | Status da notifica√ß√£o |
| created_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora de cria√ß√£o |
| updated_at | timestamp with time zone | - | N√ÉO | timezone('utc', now()) | - | Data/hora da √∫ltima atualiza√ß√£o |
| viewed | boolean | 1 byte | N√ÉO | false | - | Se foi visualizada |
| path | text | Vari√°vel | SIM | - | - | Caminho para navega√ß√£o |

**Chaves Estrangeiras:**
- user_id ‚Üí auth.users(id)

**√çndices:**
- PK: notifications_pkey (id)

---

## üìä RESUMO ESTAT√çSTICO

| Aspecto | Quantidade |
|---------|------------|
| **Total de Tabelas** | 15 |
| **Total de Campos** | 95 |
| **Chaves Prim√°rias** | 15 |
| **Chaves Estrangeiras** | 25 |
| **Campos obrigat√≥rios** | 45 |
| **Campos opcionais** | 50 |
| **Campos com valores padr√£o** | 38 |

## üîë TIPOS DE DADOS UTILIZADOS

| Tipo | Quantidade | Descri√ß√£o |
|------|------------|-----------|
| **uuid** | 45 | Identificadores √∫nicos |
| **text** | 20 | Textos vari√°veis |
| **timestamp with time zone** | 18 | Data/hora com timezone |
| **integer** | 7 | N√∫meros inteiros |
| **numeric** | 11 | N√∫meros decimais |
| **boolean** | 8 | Valores verdadeiro/falso |
| **enum** | 6 | Valores enumerados |
| **jsonb** | 1 | Dados JSON |

## üìù CONVEN√á√ïES UTILIZADAS

### Nomenclatura
- **Tabelas**: snake_case, plural
- **Campos**: snake_case, singular
- **Chaves Prim√°rias**: sempre "id"
- **Timestamps**: created_at, updated_at

### Padr√µes
- **UUIDs**: Todas as PKs s√£o UUID v4
- **Timestamps**: UTC timezone por padr√£o
- **Soft Delete**: N√£o implementado
- **Auditoria**: created_at/updated_at em todas as tabelas

---

**Fim do Dicion√°rio de Dados**
**Vers√£o**: 1.0 | **Data**: Dezembro 2024 | **Sistema**: Better Food 